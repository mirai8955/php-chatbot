# PHPコードスタイル抽出・学習フレームワーク

## 📋 プロジェクト概要

このプロジェクトは、**任意のPHPコードベースから、そのコーディングスタイルを体系的に抽出し、それを活用してユーザーの学習を支援するAIチャットボット**を構築するためのフレームワークです。

### 🎯 核となる問題意識

```
問題: チーム内でプログラミング能力を向上させたいが、
      単なる「知識」を提供するだけでなく、
      「我々のチーム特有のコーディング文化を習得させたい」

解決案: 
  1. プロジェクトのコーディングスタイルを自動抽出
  2. 段階的な問題出題（ユーザーはアウトプットができる）
  3. 詳細で的確なフィードバック（自分のコードを見直しながら学習）
  4. 点数付け（現在地を客観的に把握）
```

---

## 📚 ドキュメント体系

### 全体構成

```
haiku-4.5/
├── README.md (このファイル)
├── 00_METHODOLOGY_OVERVIEW.md (理論的背景)
├── 01_MULTILAYER_EXTRACTION_FRAMEWORK.md (抽出フレームワーク詳細)
├── 02_IMPLEMENTATION_GUIDE.md (具体的な実装手順)
├── 03_APPLICATION_TO_QUESTIONS.md (問題設計・評価方法)
└── examples/ (実装例)
```

### 各ドキュメントの役割

#### 1️⃣ **00_METHODOLOGY_OVERVIEW.md**
**「何を、なぜするのか」の理論的背景**

```
内容:
- 抽出の3つの階層構造（マクロ、ミッド、マイクロ）
- 3つのアプローチ方法（統計分析、パターンマッチング、AST解析）
- 推奨される統合的アプローチ
- 抽出成果物の形式（YAML）

読むべき人: プロジェクト全体を理解したい人
```

**💡 Key Insight:**
```
コーディングスタイルは3つの異なるレベルで存在する：

マクロレベル（アーキテクチャ）
  ↓ 「プロジェクト全体でどう整理されているか」
  ├── ディレクトリ構造
  ├── デザインパターン
  ├── 依存関係の流れ
  └── エラーハンドリング戦略

ミッドレベル（クラス・メソッド設計）
  ↓ 「個々のコンポーネント内でどう実装されているか」
  ├── メソッドサイズ
  ├── 型ヒント採用度
  ├── パラメータ設計
  └── visibility使い分け

マイクロレベル（行レベルのコード表現）
  ↓ 「実装の詳細、キーボード入力レベルでの一貫性」
  ├── インデント
  ├── ブレーススタイル
  ├── スペーシング
  └── クォート使い分け
```

#### 2️⃣ **01_MULTILAYER_EXTRACTION_FRAMEWORK.md**
**「何を抽出すべきか」の具体的フレームワーク**

```
内容:
- 各層（マクロ、ミッド、マイクロ）の詳細な抽出項目
- 各項目の「何を見るか」「どう記録するか」
- 具体例（Guzzleプロジェクト）
- 抽出チェックリスト

読むべき人: 実際に抽出を行う人、フレームワークを理解したい人
```

**💡 Key Insight:**
```
各層での抽出例（Guzzleの場合）：

マクロレベル:
- ディレクトリは機能ベース（Feature-oriented）に分割
- インターフェース採用率は85%（Interface + Implementation分離）
- DIはコンストラクタインジェクション（明示的、シンプル）
- エラーは例外ベース（例外階層で粒度調整）

ミッドレベル:
- メソッド平均15行（責任が小さく絞られている）
- 型ヒント率85%（パラメータ）、75%（戻り値）
- メソッド名は camelCase + 適切なプレフィックス（get, set, is, has）
- visibility: private 55%, public 30%, protected 15%

マイクロレベル:
- インデント: 4スペース
- ブレーススタイル: K&R (開き括弧は同じ行)
- スペーシング: 演算子前後、カンマ後にスペース
- クォート: 60% シングル、40% ダブル
```

#### 3️⃣ **02_IMPLEMENTATION_GUIDE.md**
**「どうやって抽出するか」の実装手順**

```
内容:
- ステップ1〜5: 具体的な抽出手順
- 各ステップで使用するツール・スクリプト
- 記録テンプレート（YAML形式）
- 統一スタイルプロファイルの生成方法

読むべき人: 実際に抽出ツールを実装する人、データ収集を行う人
```

**💡 Key Insight:**
```
推奨される5段階の抽出プロセス：

Step 1 マクロレベル抽出（手作業ベース）
  └─ ディレクトリ構造、クラス設計、DI、エラー戦略を記録

Step 2 ミッドレベル抽出（スクリプト・統計分析ベース）
  └─ メソッドサイズ、命名規則、型ヒント率を測定

Step 3 マイクロレベル抽出（PHPコードスニファーベース）
  └─ フォーマッティング、スペーシング、クォートを分析

Step 4 抽出結果の統合
  └─ 統一スタイルプロファイル YAML を生成

Step 5 チェックリストと検証
  └─ 抽出完了を確認
```

#### 4️⃣ **03_APPLICATION_TO_QUESTIONS.md**
**「抽出した情報をどう活用するか」の問題設計・評価方法**

```
内容:
- Part 1: 問題設計フレームワーク
  - レベル分けの定義（4段階）
  - 問題タイプの定義（6種類）
  - 問題出題テンプレート（3パターン）

- Part 2: 解答評価フレームワーク
  - スコアリングモデル（100点満点）
  - 詳細評価ルール（マイクロ→ミッド→マクロ）
  - 評価実行スクリプト（PHP）

- Part 3: フィードバック生成
  - 段階的フィードバック構造
  - 実際のフィードバック生成例

読むべき人: 問題設計、評価システムを構築する人
```

**💡 Key Insight:**
```
段階的な学習レベルの定義：

Level 1: 基礎（ファンデーション）- 1週間
  ├─ マイクロレベルの理解
  ├─ インデント、命名規則、スペーシング
  └─ 目標: フォーマッティング一致度 90%+

Level 2: 中級（ミッドレベル）- 2週間
  ├─ メソッド・クラス設計パターン
  ├─ 型ヒント、メソッドサイズ、visibility
  └─ 目標: 型ヒント率 80%+、メソッド平均15行以下

Level 3: 上級（マクロレベル）- 2週間
  ├─ アーキテクチャ・設計パターン理解
  ├─ インターフェース設計、DI、エラーハンドリング
  └─ 目標: インターフェース採用率 85%+

Level 4: エキスパート（統合）- 1週間
  ├─ プロジェクト全体の哲学理解
  ├─ 設計判断、コードレビュー、最適化提案
  └─ 目標: 総合スコア 90%+
```

---

## 🔄 ワークフロー

### 全体フロー図

```
┌─────────────────────────────────────────────────────────┐
│  対象プロジェクト（例: Guzzle HTTPクライアント）       │
└──────────────┬──────────────────────────────────────────┘
               │
        ┌──────┴──────┐
        │ 01_MULTILAYER│ (フレームワーク理解)
        │ _EXTRACTION │
        └──────┬──────┘
               │
        ┌──────┴──────┐
        │ 02_IMPLEMEN│ (実装手順に従って抽出)
        │ TATION_GUID│
        └──────┬──────┘
               │
        ┌──────┴──────┐
        │ 生成:        │
        │ - macro_level_profile.yaml
        │ - mid_level_profile.yaml
        │ - micro_level_profile.yaml
        │ - style_profile.yaml (統合)
        └──────┬──────┘
               │
        ┌──────┴──────┐
        │ 03_APPLICATION│ (活用方法を設計)
        │ _TO_QUESTIONS │
        └──────┬──────┘
               │
        ┌──────┴──────┐
        │ 生成:        │
        │ - 問題テンプレート
        │ - 評価ルール
        │ - フィードバック
        └──────┬──────┘
               │
        ┌──────┴──────┐
        │ AIチャット  │
        │ ボット実装  │
        └─────────────┘
```

### 具体的なユースケース

**ユースケース1: Guzzle HTTPクライアント**

```
1. Guzzleプロジェクトから情報抽出
   └─ 01_MULTILAYER_EXTRACTION_FRAMEWORK で何を見るか決定
   └─ 02_IMPLEMENTATION_GUIDE で実装手順に従って抽出
   
2. スタイルプロファイル生成
   ├─ マクロ: Handlerパターン, インターフェース85%, DI方針
   ├─ ミッド: メソッド平均15行, 型ヒント85%/75%
   └─ マイクロ: 4スペース, K&Rスタイル, カンマ後スペース

3. 問題設計
   ├─ Level 1: 「以下のコードを4スペースインデントに直してください」
   ├─ Level 2: 「以下のメソッドに型ヒントを追加してください」
   └─ Level 3: 「HandlerInterfaceパターンで実装してください」

4. 評価
   └─ 03_APPLICATION_TO_QUESTIONS のスコアリングモデルに従う
   └─ マイクロ 25点 + ミッド 40点 + マクロ 35点 = 100点満点

5. フィードバック
   └─ 「型ヒント率が65%です。プロジェクト目標は85%なので...」
```

---

## 📊 スコアリングの構成

### 総合スコア 100点

```
マイクロレベル: 25点 (行レベルの一貫性)
├─ インデント: 5点
├─ ブレーススタイル: 5点
├─ スペーシング: 8点
└─ 命名: 7点

ミッドレベル: 40点 (メソッド・クラス設計)
├─ 型ヒント: 15点
├─ メソッド設計: 15点
└─ visibility: 10点

マクロレベル: 35点 (アーキテクチャ・設計パターン)
├─ アーキテクチャ一貫性: 12点
├─ デザインパターン: 12点
└─ エラーハンドリング: 11点
```

---

## 🛠️ 実装ロードマップ

### Phase 1: 理論と設計 ✅ (完了)
- [x] 抽出方法論の確立（`00_METHODOLOGY_OVERVIEW.md`）
- [x] 多層フレームワークの設計（`01_MULTILAYER_EXTRACTION_FRAMEWORK.md`）
- [x] 実装ガイドの作成（`02_IMPLEMENTATION_GUIDE.md`）
- [x] 問題設計・評価フレームワークの確立（`03_APPLICATION_TO_QUESTIONS.md`）

### Phase 2: ツール実装 (次のステップ)
- [ ] マクロレベル抽出スクリプト
- [ ] ミッドレベル統計分析ツール
- [ ] マイクロレベルコードスニファー
- [ ] スタイルプロファイル統合ツール
- [ ] 評価エンジン実装

### Phase 3: チャットボット実装
- [ ] ユーザーインタフェース
- [ ] 問題出題エンジン
- [ ] 評価・フィードバック生成エンジン
- [ ] レベル分けシステム
- [ ] 進捗追跡機能

### Phase 4: テストと最適化
- [ ] 実際のプロジェクトで抽出精度を検証
- [ ] ユーザーテストで学習効果を測定
- [ ] フィードバック品質の改善

---

## 💡 重要なポイント

### 1. 「理想」ではなく「現実」を抽出する

```
❌ 間違い: 「PHPのベストプラクティスは...」
✅ 正解: 「このプロジェクトではどうしているか」

理由: ユーザーがプロジェクトに早期に適応するために、
     プロジェクト固有の文化・パターンを学ぶ必要がある
```

### 2. 多層的な理解が必須

```
❌ 1層レベルの抽出では不十分:
   - マイクロだけ → 「ルール」を覚えるだけ、なぜかが分からない
   - ミッドだけ → 「パターン」は分かるが、詳細がぶれる
   - マクロだけ → 「考え方」は分かるが、実装できない

✅ 3層を統合:
   - ユーザーは「なぜ？」から始まる
   - 層ごとに学習 → 立体的な理解
   - 総合的な設計判断ができるようになる
```

### 3. 段階的な学習設計

```
学習パターン:

Level 1 (基礎): 「ルール」を覚える
  └─ マイクロレベルに焦点
  └─ 「このプロジェクトでは4スペースインデント」

Level 2 (中級): 「パターン」を理解する
  └─ ミッドレベルに焦点
  └─ 「このプロジェクトではメソッドは15行以下」

Level 3 (上級): 「考え方」を習得する
  └─ マクロレベルに焦点
  └─ 「このプロジェクトではHandler パターンで拡張性を確保」

Level 4 (エキスパート): 「統合」できるようになる
  └─ 全層を統合
  └─ 「新機能をこのプロジェクトの哲学に基づいて設計」
```

---

## 📖 読む順序

**初めての方:**
1. `00_METHODOLOGY_OVERVIEW.md` (15分)
   → 「何をするのか、なぜするのか」を理解

2. `01_MULTILAYER_EXTRACTION_FRAMEWORK.md` (20分)
   → 「何を見るか」を具体的に学ぶ

3. `02_IMPLEMENTATION_GUIDE.md` (20分)
   → 「どうやって実装するか」を学ぶ

4. `03_APPLICATION_TO_QUESTIONS.md` (25分)
   → 「どう活用するか」を理解

**実装者向け:**
1. `02_IMPLEMENTATION_GUIDE.md` (詳細に読む)
2. 必要に応じて `01_MULTILAYER_EXTRACTION_FRAMEWORK.md` で詳細確認

**問題設計者向け:**
1. `03_APPLICATION_TO_QUESTIONS.md` (詳細に読む)
2. `01_MULTILAYER_EXTRACTION_FRAMEWORK.md` で評価対象を確認

---

## 🎓 学習効果の期待値

このフレームワークを用いた場合の学習効果（Guzzleの例）：

```
従来の方法（ドキュメントを読む）:
- 1ヶ月で基本的な使い方は分かる
- 「なぜこう書くのか」が曖昧なまま

このフレームワーク（段階的問題出題 + 詳細フィードバック）:
- 1週間で基礎ルールを習得（Level 1）
- 2週間で設計パターンを理解（Level 2）
- 3週間で全体の哲学を習得（Level 3）
- 4週間でエキスパート級に（Level 4）

総合スコア推移（例）:
- Day 0:  初期スコア 30/100
- Day 7:  Level 1完了 65/100
- Day 21: Level 2完了 75/100
- Day 35: Level 3完了 85/100
- Day 42: Level 4完了 92/100
```

---

## 📝 ライセンス

このフレームワークは、チーム内のプログラミング教育のために自由に使用・改変できます。

---

## 🤝 貢献

ご意見・改善提案は大歓迎です。特に：
- 他のPHPプロジェクトでの抽出検証結果
- 学習効果の測定データ
- フィードバック品質の改善案

---

**作成日**: 2024年11月  
**バージョン**: 1.0.0  
**ステータス**: 🟢 正式版
