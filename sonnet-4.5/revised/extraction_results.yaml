# Monolog コーディングスタイル抽出結果
# 抽出日: 2025-11-01
# 方法: 設定ファイル解析 + コードベース定量分析

project:
  name: monolog/monolog
  type: library
  php_version: ">=8.1"
  url: https://github.com/Seldaek/monolog
  
# ===== 定量的メトリクス（実測値） =====
quantitative_metrics:
  files:
    total_php_files: 121
    test_files: 92
    total_lines: ~15000  # 概算
    
  strict_types:
    total_files: 121
    with_strict_types: 121
    coverage: "100%"
    conclusion: "全ファイルで厳密な型チェックを採用"
    
  array_syntax:
    old_syntax_count: 50
    new_syntax_count: 784
    short_ratio: "94%"
    conclusion: "圧倒的に短い配列構文 [] を使用"
    
  type_system:
    typed_properties_count: 78
    fqn_function_files: 47
    fqn_ratio: "38.8%"
    conclusion: "型システムを積極活用、パフォーマンス重視箇所で完全修飾関数"
    
  interfaces:
    count: 7
    examples:
      - HandlerInterface
      - FormatterInterface
      - ProcessorInterface
      - ResettableInterface

# ===== 設定ファイルベース抽出 =====
configuration_analysis:
  php_cs_fixer:
    file: .php-cs-fixer.php
    found: true
    base_ruleset: "@PSR2"
    psr_equivalence: "PSR-12相当（追加ルールにより）"
    total_rules: 30+
    
    key_rules:
      # 必須ルール
      - rule: declare_strict_types
        value: true
        severity: error
        points: 10
        
      - rule: array_syntax
        value: short
        severity: error
        points: 5
        
      - rule: native_function_invocation
        value: true
        severity: warning
        points: 3
        
      - rule: no_unused_imports
        value: true
        severity: warning
        points: 3
        
      - rule: trailing_comma_in_multiline
        value: true
        severity: warning
        points: 3
        
      # PHPDoc ルール
      - rule: phpdoc_align
        value: true
        severity: info
        points: 2
        
      - rule: phpdoc_order
        value: true
        severity: info
        points: 2
        
      - rule: no_superfluous_phpdoc_tags
        value: {allow_mixed: true}
        severity: info
        points: 3
        
  phpstan:
    file: phpstan.neon.dist
    found: true
    level: 8  # 最高レベル
    strict_rules: true
    deprecation_rules: true
    treat_phpdoc_as_certain: false
    report_unmatched_ignored_errors: true
    
    conclusion: "最高レベルの静的解析を採用"
    
  phpunit:
    file: phpunit.xml.dist
    found: true
    bootstrap: tests/bootstrap.php
    test_directory: tests/Monolog/
    coverage_enabled: true

# ===== コーディング規約（抽出結果） =====
coding_conventions:
  file_structure:
    order:
      - "<?php declare(strict_types=1);"
      - "空行"
      - "ライセンスコメント（3行ブロック）"
      - "空行"
      - "namespace宣言"
      - "use文（アルファベット順）"
      - "空行"
      - "クラスドキュメント"
      - "クラス定義"
      
  naming_conventions:
    classes: PascalCase
    methods: camelCase
    properties: camelCase
    constants: UPPER_SNAKE_CASE
    interfaces: PascalCase + "Interface" suffix
    tests: PascalCase + "Test" suffix
    
  type_system:
    strict_types: required
    typed_properties: required
    param_types: required
    return_types: required
    union_types: allowed
    nullable_types: allowed
    readonly: used  # PHP 8.1+
    
  docblocks:
    usage: minimal-but-precise
    required_for:
      - public methods
      - complex types
      - generics (PHPStan annotations)
    tags_order:
      - "@param"
      - "@return"
      - "@throws"
      - "@phpstan-param"
      - "@phpstan-return"
      
  design_patterns:
    detected:
      - pattern: Strategy
        usage: Handler implementations
        frequency: high
        
      - pattern: Chain of Responsibility
        usage: Handler stack
        frequency: high
        
      - pattern: Decorator
        usage: Processor pipeline
        frequency: medium
        
      - pattern: Value Object
        usage: LogRecord
        frequency: medium

# ===== PSR 標準との関係 =====
psr_compliance:
  psr_2:
    base: true
    note: "@PSR2 ルールセットをベースとするが、追加ルールで拡張"
    
  psr_3:
    compliance: true
    note: "PSR-3 Logger Interface を実装"
    
  psr_4:
    compliance: true
    autoload: "Monolog\\ => src/Monolog"
    
  psr_12:
    effective_compliance: true
    note: "@PSR2 + カスタムルールで実質的にPSR-12相当を実現"
    differences:
      - "declare(strict_types=1) は明示的に要求"
      - "trailing_comma_in_multiline は明示的に要求"
      - "native_function_invocation は追加（PSR-12にはない）"

# ===== スタイルルール（評価基準用） =====
style_rules:
  mandatory:  # 必須（違反は減点大）
    - rule_id: R001
      name: strict_types_declaration
      description: "全ファイルで declare(strict_types=1) を使用"
      coverage: 100%
      penalty_if_missing: 10
      
    - rule_id: R002
      name: typed_properties
      description: "全プロパティに型宣言"
      coverage: high
      penalty_if_missing: 8
      
    - rule_id: R003
      name: short_array_syntax
      description: "[] 構文を使用（array() 禁止）"
      coverage: 94%
      penalty_if_missing: 5
      
    - rule_id: R004
      name: typed_parameters
      description: "全メソッド引数に型宣言"
      coverage: high
      penalty_if_missing: 8
      
    - rule_id: R005
      name: return_types
      description: "全メソッドに戻り値の型宣言"
      coverage: high
      penalty_if_missing: 8
      
  recommended:  # 推奨（違反は減点小）
    - rule_id: R101
      name: native_function_fqn
      description: "ネイティブ関数は完全修飾名で呼び出し"
      coverage: 38.8%
      penalty_if_missing: 3
      
    - rule_id: R102
      name: no_unused_imports
      description: "未使用のuse文を削除"
      coverage: high
      penalty_if_missing: 3
      
    - rule_id: R103
      name: trailing_comma
      description: "複数行配列に末尾カンマ"
      coverage: high
      penalty_if_missing: 3
      
  optional:  # オプション（情報提供のみ）
    - rule_id: R201
      name: phpdoc_align
      description: "PHPDocのタグを揃える"
      coverage: high
      penalty_if_missing: 2
      
    - rule_id: R202
      name: phpdoc_order
      description: "PHPDocのタグを標準順序で"
      coverage: high
      penalty_if_missing: 2

# ===== 評価軸の配点 =====
scoring_weights:
  coding_standards: 25  # コーディング規約遵守
  readability: 25       # 可読性
  maintainability: 25   # 保守性
  efficiency: 25        # 効率性

# ===== 抽出方法のメタ情報 =====
extraction_metadata:
  methods_used:
    - method: configuration_file_analysis
      priority: 1
      reliability: very_high
      files_analyzed:
        - .php-cs-fixer.php
        - phpstan.neon.dist
        - phpunit.xml.dist
        
    - method: quantitative_code_analysis
      priority: 2
      reliability: high
      commands_used:
        - "find src -name '*.php' | wc -l"
        - "grep -r 'declare(strict_types=1)' src"
        - "grep -r 'array(' src"
        - "grep -r '\\count\\|\\is_' src"
        
    - method: representative_code_reading
      priority: 3
      reliability: medium
      files_read:
        - src/Monolog/Logger.php
        - src/Monolog/Handler/StreamHandler.php
        - src/Monolog/Formatter/FormatterInterface.php
        - tests/Monolog/LoggerTest.php
        
  verification:
    reproducible: true
    third_party_verifiable: true
    automated: partially
    
  limitations:
    - "完全修飾関数の使用率は正確に測定困難（正規表現の限界）"
    - "型付きプロパティのカウントは string 型のみ"
    - "デザインパターンの検出は手動"
    
  improvements_needed:
    - "AST解析による構造的分析"
    - "phpstan実行による型カバレッジ測定"
    - "phpunit実行によるテストカバレッジ測定"

# ===== 信頼性評価 =====
confidence_levels:
  php_version: very_high  # composer.jsonから直接
  strict_types: very_high  # 全ファイルgrep済み
  array_syntax: high  # grep済みだが正規表現の限界あり
  type_system: medium  # 部分的な測定
  design_patterns: medium  # 手動分析
  
# ===== チーム適用時の注意点 =====
team_adoption_notes:
  strengths:
    - "Monologは業界標準的な高品質コード"
    - "厳密な型システムでバグを防止"
    - "PSR標準準拠で他プロジェクトとの親和性高い"
    
  considerations:
    - "PHP 8.1+ 必須（古いプロジェクトには適用困難）"
    - "strict_types=1 は既存コードへの適用が大変"
    - "完全修飾関数はパフォーマンスとのトレードオフ"
    
  customization_points:
    - "native_function_invocation: チームの方針で調整可"
    - "phpdoc_* ルール: プロジェクトの規模で調整可"
    - "trailing_comma: 好みで調整可"

