# Sonnet-4.5 作業ディレクトリ

**作成日**: 2025-11-01  
**AI**: Claude Sonnet 4.5  
**プロジェクト**: PHPコーチAI開発のための調査・設計資料

---

## 📁 ディレクトリ概要

このディレクトリは、チームのPHPプログラミング能力向上を目的としたコーチAIシステムの開発に向けた、
初期調査と設計資料を格納しています。

---

## 📚 ドキュメント一覧

### 1. コードベース分析

#### `01_monolog_coding_style_analysis.md`
**目的**: テスト用リポジトリ（Monolog）からのコーディングスタイル抽出

**内容**:
- 採用した分析手法の説明
- 推奨される追加の分析手法
- 抽出されたコーディングスタイルの詳細
- 教育的観点からの重要ポイント
- 定量的メトリクス
- コーチAIへの応用方法

**主な成果**:
- ✅ 10種類以上の分析手法を特定
- ✅ 60以上のコーディングルールを抽出
- ✅ レベル別の学習ポイントを整理
- ✅ 評価基準のテンプレートを作成

#### `monolog_style_rules.yaml`
**目的**: 抽出したスタイルルールの構造化データ

**内容**:
- 必須のコーディングルール（カテゴリ別）
- 推奨されるベストプラクティス
- 静的解析設定
- コード品質メトリクス目標値
- 評価基準のウェイト
- レベル別の必須知識

**特徴**:
- YAML形式で機械可読
- 各ルールに点数配分を設定
- AIシステムが直接参照可能
- 拡張・カスタマイズが容易

---

### 2. システム設計

#### `02_coach_ai_system_design.md`
**目的**: PHPコーチAIシステムの全体設計

**内容**:
- システム概要と主要機能
- アーキテクチャ図
- 5つの主要モジュール詳細設計
  1. Codebase Analyzer（コードベース分析エンジン）
  2. Question Generator（問題生成エンジン）
  3. Solution Evaluator（解答評価エンジン）
  4. Feedback Generator（フィードバック生成エンジン）
  5. Progress Tracker（進捗追跡システム）
- 技術スタック
- データフロー
- 実装優先順位（Phase 1-4）
- セキュリティ考慮事項
- 成功指標（KPI）

**主な設計決定**:
- **評価軸**: コーディング規約（25点）+ 可読性（25点）+ 保守性（25点）+ 効率性（25点）
- **AI統合**: Claude Sonnet 4.5をプライマリLLMとして使用
- **段階的実装**: MVP → AI統合 → 進捗追跡 → 高度な機能

---

### 3. 問題設計

#### `03_question_examples_by_level.md`
**目的**: レベル別の問題サンプルと出題方針

**内容**:
- 10段階レベルの概要
- 各レベルの具体的な問題例
  - Level 1: strict_types宣言、配列構文
  - Level 2: 型ヒント
  - Level 3: エラーハンドリング
  - Level 4: OOP設計
  - Level 5: デザインパターン（Strategy）
  - Level 7: Monologスタイルのハンドラ実装
  - Level 10: チーム固有の課題
- 評価基準の詳細
- 問題生成の自動化手法
- 学習効果の測定方法

**特徴**:
- 実践的な問題設計
- 段階的な難易度上昇
- Monologスタイルに準拠
- テストコードを含む

---

## 🎯 コーディングスタイル抽出の方法論

### 採用した手法

1. **静的設定ファイル分析** ⭐⭐⭐⭐⭐
   - `.php-cs-fixer.php`: コーディングスタイル定義
   - `composer.json`: プロジェクト構造とPSR標準
   - `phpstan.neon.dist`: 静的解析レベル
   - **効果**: 明示的なルールを直接抽出可能

2. **実コード分析** ⭐⭐⭐⭐
   - 主要クラス（Logger, StreamHandler等）の読解
   - 命名規則、構造パターンの把握
   - **効果**: 実際の適用例を理解

3. **テストコード分析** ⭐⭐⭐
   - テストの構造とカバレッジ
   - **効果**: 品質基準を理解

### 推奨される追加手法

今後、他のコードベースを分析する際に有効な手法：

1. **AST（抽象構文木）解析** ⭐⭐⭐⭐⭐
   - ツール: `nikic/php-parser`
   - 効果: 構造的なパターンを定量的に抽出
   - 用途: メソッド長、複雑度、パターン頻度の測定

2. **メトリクス自動計算** ⭐⭐⭐⭐
   - ツール: `phpmetrics`
   - 効果: 循環的複雑度、保守性指数などを数値化
   - 用途: 客観的な品質基準の設定

3. **Git履歴分析** ⭐⭐⭐
   - 効果: プロジェクトの進化と意思決定を理解
   - 用途: リファクタリングのトレンド把握

4. **セマンティック検索** ⭐⭐⭐⭐
   - 効果: 類似パターンの自動抽出
   - 用途: デザインパターン使用頻度の測定

5. **PHPDoc完全スキャン** ⭐⭐⭐
   - 効果: ドキュメント密度とパターンの測定
   - 用途: ドキュメント基準の設定

---

## 📊 抽出結果サマリー

### Monologプロジェクトの特徴

#### 基本情報
```yaml
Project: monolog/monolog
Type: Library
PHP Version: >= 8.1
PSR Compliance: PSR-2, PSR-3, PSR-4
```

#### コーディング規約（主要なもの）

| カテゴリ | ルール | 重要度 |
|---------|--------|--------|
| 構文 | `declare(strict_types=1)` 必須 | ⭐⭐⭐⭐⭐ |
| 配列 | 短い配列構文 `[]` | ⭐⭐⭐⭐⭐ |
| 型 | すべての引数・戻り値に型ヒント | ⭐⭐⭐⭐⭐ |
| 関数 | ネイティブ関数は完全修飾 `\count()` | ⭐⭐⭐ |
| 比較 | 厳密比較 `!==` 使用 | ⭐⭐⭐⭐ |
| PHPDoc | 型情報を補完 | ⭐⭐⭐⭐ |

#### デザインパターン

| パターン | 使用箇所 | 頻度 |
|---------|---------|------|
| Strategy | Handler実装 | 高 |
| Chain of Responsibility | Handlerスタック | 高 |
| Decorator | Processor | 中 |

#### 品質基準

| 指標 | 目標値 |
|------|--------|
| PHPStan Level | 8（最高） |
| 平均メソッド長 | ~15行 |
| 循環的複雑度 | 2-5（低い） |
| PHPDoc密度 | ~27% |

---

## 🚀 次のステップ

### Phase 1: MVP実装（2-3週間）

#### 優先度: 高 🔴

1. **スタイルルールエンジン**
   - `monolog_style_rules.yaml` の読み込み
   - ルールベースの評価システム

2. **基本問題バンク**
   - Level 1-3の問題を10-15問作成
   - テンプレートベースの生成

3. **PHP-CS-Fixer統合**
   - コーディング規約の自動チェック
   - 違反の詳細レポート

4. **CLIインターフェース**
   ```bash
   php coach.php start --level=1
   php coach.php submit solution.php
   php coach.php progress
   ```

### Phase 2: AI統合（3-4週間）

#### 優先度: 高 🔴

1. **Claude API統合**
   - 問題生成プロンプト設計
   - 評価プロンプト設計
   - フィードバック生成

2. **動的問題生成**
   - コードベース分析結果の活用
   - ユーザーの弱点に応じた問題

3. **高度な評価**
   - 可読性・保守性のAI評価
   - 総合的なコードレビュー

### Phase 3: 進捗追跡（2-3週間）

#### 優先度: 中 🟡

1. **データベース設計**
   - ユーザー管理
   - 履歴管理
   - スキル追跡

2. **進捗可視化**
   - 成長グラフ
   - 弱点分析
   - レベルアップ判定

### Phase 4: Webアプリ化（4-6週間）

#### 優先度: 中 🟡

1. **フロントエンド開発**
   - React + TypeScript
   - Monaco Editor統合
   - ダッシュボード

2. **バックエンドAPI**
   - Laravel/Symfony
   - RESTful API
   - 認証・認可

---

## 🔧 技術的な検討事項

### 解決済み ✅

1. **コーディングスタイルの抽出方法**
   - → PHP-CS-Fixer設定ファイルの解析が最も効果的

2. **評価軸の定義**
   - → 4軸（規約、可読性、保守性、効率性）× 25点

3. **レベル定義**
   - → 10段階に明確に定義

### 未解決・要検討 ⚠️

1. **コード実行の安全性**
   - Dockerコンテナでの隔離実行
   - リソース制限の実装方法

2. **AI評価の精度と一貫性**
   - プロンプトエンジニアリングの最適化
   - 評価の再現性確保

3. **スケーラビリティ**
   - 複数ユーザーの同時使用
   - 大規模コードベースの分析

4. **チーム固有のカスタマイズ**
   - 各チームの独自ルール追加方法
   - 既存コードベースとの統合

---

## 💡 重要な洞察

### 1. コーディングスタイル抽出の鍵

**発見**: 設定ファイル（`.php-cs-fixer.php`、`phpstan.neon`）が最も信頼性の高い情報源

**理由**:
- プロジェクトの意図的な選択が明示されている
- 機械可読で自動化しやすい
- 実際に自動チェックされているため、実態と一致

**応用**:
- まず設定ファイルを探す
- なければ実コードから統計的に抽出
- AIで補完的な分析

### 2. 教育効果を高める問題設計

**発見**: 「悪いコードを良くする」形式が最も学習効果が高い

**理由**:
- Before/Afterで変化が明確
- なぜそのルールが重要かを理解しやすい
- 実務で頻繁に行うリファクタリングの練習になる

**応用**:
- Level 1-5は主にリファクタリング問題
- Level 6以降は設計・実装問題
- Level 10は実プロジェクトの改善

### 3. 評価の自動化と人間の判断

**発見**: 完全自動化は難しく、AIとツールの組み合わせが最適

**バランス**:
```
コーディング規約（25点）
  └─ PHP-CS-Fixer: 自動化可能 ✅

可読性（25点）
  └─ メトリクス（50%）+ AI判断（50%）

保守性（25点）
  └─ SOLID原則: AI判断が必要

効率性（25点）
  └─ 実行測定（60%）+ AI分析（40%）
```

---

## 📖 参考資料

### プロジェクト
- [Monolog](https://github.com/Seldaek/monolog)
- [PHP-CS-Fixer](https://github.com/FriendsOfPHP/PHP-CS-Fixer)
- [PHPStan](https://phpstan.org/)

### 標準
- [PSR-2: Coding Style Guide](https://www.php-fig.org/psr/psr-2/)
- [PSR-4: Autoloader](https://www.php-fig.org/psr/psr-4/)
- [PSR-3: Logger Interface](https://www.php-fig.org/psr/psr-3/)

### ツール
- [nikic/PHP-Parser](https://github.com/nikic/PHP-Parser)
- [phpmetrics](https://www.phpmetrics.org/)

---

## 📝 更新履歴

### 2025-11-01
- 初版作成
- Monologコードベース分析完了
- システム設計完了
- 問題サンプル作成完了

---

**作成者**: Claude Sonnet 4.5  
**プロジェクト**: PHP Coach AI Development  
**ステータス**: 設計フェーズ完了、実装準備完了

