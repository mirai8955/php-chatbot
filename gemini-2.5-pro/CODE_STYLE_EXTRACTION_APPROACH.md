# AIチャットボットのためのプロジェクトコードスタイル抽出アプローチ

## 1. はじめに

このドキュメントは、プログラミング教育AIチャットボットが、対象となるPHPプロジェクト固有のコーディングスタイルや設計思想を自動的に抽出し、学習するためのアプローチを提案するものです。

ここでの「コードスタイル」とは、単なるフォーマット（PSR-12など）だけでなく、命名規則、ディレクトリ構造、設計パターン、依存関係の扱い方など、プロジェクトに根付く「暗黙のルール」や「お作法」までを含む広義の概念を指します。

この抽出アプローチの目的は、ユーザーがプロジェクトの作法に迅速に慣れ、チームの一員として質の高いコードを書けるようになるための、効果的な問題作成と的確なフィードバック生成を実現することです。

## 2. 抽出アプローチの全体像

静的コード解析を主軸に、以下の3つのレベルで多層的に分析を行います。これにより、表面的な規約からプロジェクトの設計思想まで、段階的かつ網羅的にコードの特徴を捉えます。

-   **Level 1: 明示的な規約の抽出**
    -   リンター等の設定ファイルから、定義済みのルールを直接取得します。
-   **Level 2: 構文レベルの統計的分析**
    -   抽象構文木（AST）を用いてコードを解析し、統計的に優位なパターン（命名規則など）を抽出します。
-   **Level 3: 設計・アーキテクチャレベルのパターン抽出**
    -   ファイル構成やクラス間の関係性を分析し、プロジェクト固有の設計パターンや「あるある」な実装方法を特定します。

## 3. 具体的な抽出手法

### Level 1: 明示的な規約の抽出（リンター・静的解析ツール設定）

プロジェクトに導入されている静的解析ツールの設定ファイルは、チームが合意した「公式ルール」の宝庫です。

-   **対象ファイル:**
    -   ` .php-cs-fixer.dist.php`, `.php_cs` (PHP Coding Standards Fixer)
    -   `phpstan.neon`, `phpstan.neon.dist` (PHPStan)
    -   `psalm.xml`, `psalm.xml.dist` (Psalm)
    -   `composer.json` (`require-dev`セクションから利用ツールを特定)
-   **抽出内容:**
    -   採用しているPSR標準（PSR-1, PSR-12など）。
    -   インデント、括弧の位置、改行などのフォーマットルール。
    -   型チェックの厳密性レベル。
    -   未使用の変数や到達不能なコードの扱い。
-   **分析手法:**
    -   各ツールの設定ファイルをパースし、有効になっているルールセットやカスタマイズされたルールをリストアップします。

### Level 2: 構文レベルの統計的分析（AST解析）

明示的なルールだけではカバーできない、より実践的なコーディングの癖を統計的に分析します。PHP-Parserのようなライブラリを用いてソースコードをASTに変換し、ノードを走査することで実現します。

-   **命名規則:**
    -   変数 (`$variableName`, `$variable_name`)
    -   関数・メソッド (`functionName`, `function_name`)
    -   クラス (`ClassName`)
    -   定数 (`CONSTANT_NAME`)
    -   各々の命名規則（camelCase, snake_case, PascalCaseなど）の出現頻度を計測し、最も一般的なスタイルを特定します。
-   **コーディング構文:**
    -   配列定義 (`array()` vs `[]`) の使用比率。
    -   制御構文 (`if`/`else`, `switch`, `match`) の典型的な書き方。
    -   `final` や `readonly` キーワードの使用頻度と使用箇所（クラス、メソッド、プロパティ）。
    -   型宣言（引数、返り値、プロパティ）の網羅率。
-   **コメント・PHPDoc:**
    -   PHPDoc (`@param`, `@return`, `@throws`など) の記述率。
    -   コメントのスタイル（`//` vs `/* */`）。

### Level 3: 設計・アーキテクチャレベルのパターン抽出

コードの構造やクラス間の関係性から、プロジェクトの設計思想を読み解きます。これは、ユーザーが新しい機能を追加する際に最も重要となる「お作法」を理解する鍵となります。

-   **ディレクトリ構造と責務の関連付け:**
    -   `src/` ディレクトリ配下の構造（例: `Controller`, `Service`, `Repository`, `Entity`）を分析します。
    -   ディレクトリ名と、その中に配置されるクラスの命名規則（サフィックス/プレフィックス）の関連性を抽出します。（例: `src/Controller` には `*Controller.php` という名前のファイルが置かれる）
-   **依存関係の解決（DI）:**
    -   クラスの `__construct` メソッドを分析し、どのようなクラスが注入されているかを調査します。
    -   特に、特定のインターフェース（例: `Psr\Log\LoggerInterface`）が多くのクラスで注入されている場合、それはプロジェクトの基本原則である可能性が高いです。
-   **共通の抽象化（インターフェースと基底クラス）:**
    -   頻繁に実装（`implements`）されるインターフェースや、継承（`extends`）される基底クラスを特定します。
    -   これにより、「このプロジェクトで新しい`Hoge`機能を作る際は、`HogeInterface`を実装し、`BaseHoge`を継承するのが一般的だ」といったテンプレートを抽出できます。
-   **エラーハンドリング:**
    -   `try-catch` ブロックで捕捉されている例外クラスの種類と頻度を分析します。
    -   プロジェクト固有のカスタム例外クラスがどのように定義され、`throw` されているかを特定します。

## 4. 抽出したスタイルの活用方法

これらのアプローチで抽出した「プロジェクトのコードスタイル」は、AIチャットボットの以下の機能に直接活用できます。

-   **問題作成への応用:**
    -   **規約違反の修正問題:** Level 1, 2で特定したスタイルに意図的に違反したコードを提示し、リファクタリングさせる。（例: 「このコードの変数はスネークケースで書かれていますが、このプロジェクトではキャメルケースが一般的です。修正してください」）
    -   **実践的な機能追加問題:** Level 3で抽出した設計パターンに基づき、新しい機能の実装を求める。（例: 「このプロジェクトの作法に倣って、新しい`Product`の価格を更新する`ProductUpdaterService`を作成してください。ただし、ロギングには`LoggerInterface`を使用してください」）
-   **評価とフィードバックへの応用:**
    -   ユーザーが提出したコードに対して上記1〜3の観点で自動解析を行い、スタイルへの準拠度を点数化します。
    -   スタイルから逸脱している箇所を具体的に指摘し、「なぜこのプロジェクトではそのように書くのか」（例: 保守性、チーム内の合意など）という背景情報と共に、改善案を提示します。

## 5. 結論

この多層的な抽出アプローチにより、AIチャットボットはコードの表面的なスタイルから、その背景にある設計思想までを深く理解することができます。これにより、単なる正誤判定を超え、ユーザーがプロジェクトの文脈に即した実践的なスキルを習得するための、質の高い教育体験を提供することが可能になります。
