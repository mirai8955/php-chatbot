# Monolog (v3.x) スタイルプロファイル

project:
  name: monolog/monolog
  php_version_min: "8.1"
  autoload:
    psr4:
      Monolog\\: src/Monolog
  testing:
    framework: phpunit
    phpunit_config: phpunit.xml.dist
    tests_dir: tests/Monolog
    bootstrap: tests/bootstrap.php
  static_analysis:
    phpstan:
      level: 8
      includes:
        - phpstan-baseline.neon
        - phpstan-ignore-by-php-version.neon.php
        - phar://phpstan.phar/conf/bleedingEdge.neon
        - vendor/phpstan/phpstan-strict-rules/rules.neon
        - vendor/phpstan/phpstan-deprecation-rules/rules.neon
      exclude_paths:
        - src/Monolog/Handler/PHPConsoleHandler.php

coding_conventions:
  files:
    declare_strict_types: true  # src 全体で徹底（grep 121/121）
    indentation: 4-spaces
    line_length_soft_limit: 120  # 観測ベース（厳密な設定ファイルは未検出）
  naming:
    classes: StudlyCase
    interfaces: StudlyCase
    traits: StudlyCase+TraitSuffix(optional)
    methods: camelCase
    properties: camelCase
    constants: UPPER_SNAKE_CASE
    tests: '*Test.php' under tests/Monolog
  typing:
    strict_types: true
    typed_properties: prefer
    param_and_return_types: required (where applicable)
    nullability: explicit_nullable
    unions_and_intersections: allowed
    generics_via_phpdoc: used (e.g., @phpstan-var, @phpstan-return)
  docblocks:
    usage: minimal-but-precise
    preferred_for:
      - generics annotations for phpstan
      - complex array shapes
      - deprecation notes
  exceptions:
    invalid_argument: Psr\Log\InvalidArgumentException or \InvalidArgumentException
    logic_errors: \LogicException
    unexpected_value: \UnexpectedValueException
  design:
    patterns:
      - chain_of_responsibility (handlers stack)
      - pipeline (processors)
      - value_object (LogRecord)
    logger:
      level_mapping: RFC5424->Monolog (int→Level enum)
      microsecond_timestamps: default_on
      loop_detection: enabled (depth guards with Fiber-aware WeakMap)
    handlers:
      write_contract: handle(LogRecord): bool with bubbling semantics
      processing_base: AbstractProcessingHandler for formatter integration
    processors:
      signature: (LogRecord): LogRecord

style_tools_presence:
  phpcs_or_php_cs_fixer: unknown  # 明示的な設定ファイルはリポジトリ直下に未検出
  editorconfig: unknown
  phpmd: not_configured
  rector: not_configured

repository_layout:
  src: src/Monolog
  domains:
    - Logger
    - Handler/*
    - Formatter/*
    - Processor/*
    - Attribute/*
    - Utils / ErrorHandler / DateTimeImmutable / Level / LogRecord
  tests: tests/Monolog

readability_and_quality_heuristics:
  small_methods_preferred: true
  early_returns: used
  strict_visibility: used
  state_reset_capability:
    handlers_and_processors_resettable: supported via ResettableInterface
  mutability:
    prefer_immutable_value_objects: true (LogRecord)
    services_mutable_state: minimal

security_and_safety:
  input_validation_in_handlers: contextual
  resource_management:
    streams_locked_on_write: optional (useLocking)
    close_on_reset_for_files: true (to avoid leaks in long-running processes)
  error_reporting:
    custom_error_handler_when_io: used in StreamHandler

api_policies:
  deprecations:
    logger_level_constants: deprecated in favor of Level enum
  bc_layers:
    tests_bootstrap_aliases_old_phpunit_class: provided

scoring_guideline_suggestions:
  correctness: prefers exhaustive test coverage (phpunit)
  guideline_adherence: phpstan(level 8 + strict), deprecation rules clean
  readability: consistent naming/typing, minimal docblocks with precise phpdoc for generics
  maintainability: low complexity, resettable handlers, decoupled processors
  efficiency: chunked IO writes, minimal locale-sensitive ops, lazy record initialization

notes:
  - Monolog は PHP 8.1 の機能（Enums, Fibers, readonly-likeパターン）を積極活用
  - Generics は PHPDoc 経由で phpstan に明示
  - 明示的な CS 設定（PHPCS/CS-Fixer）が無くとも PSR-12 互換の実装スタイル

